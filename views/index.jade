extends layout

block content

	if message
		p.pull-center.message #{message}
	if error
		p.pull-center.error #{error}

	.main.pure-g-r
		if (!user)
			.pure-u-1-2.pull-center
				h1.thin
					a(href="/")= title
				#infoBox
				p#about
				form(action="/login", method="post")
					.pure-g-r
						.pure-u-1-4#username
							input(type="email", name="username", placeholder="Email", autofocus="autofocus")
						.pure-u-1-4#password
							input(type="password", name="password", placeholder="Password")
						.pure-g-r
							.pure-u-1-2#submit
								input(type="submit", value="Log In")
			.pure-u-1-2.pull-center
				p.lead.sans <a href="/register" class="btn message-home">Start</a> seeing yourself, graphed.
				p Track your progress on <strong>anything</strong> you can quantify.

		if user
			.pure-u-1-2.pull-center
					if user.username
						h2.thin.no-mobile #{ user.username }, #{title}
					if (!user.username)
						h2.thin.no-mobile
							a(href="/") You, #{title}
					if user.birthdate
						p
							| You are <a href="/account" id="age">many, many</a> years old.
					if (!user.birthdate)
						p.lead.intro
							| You should take a moment and <a href="/account" class="">augment your account</a>.
						p It will make everything easier down the road.

			.pure-u-1-3.pull-center
				form(action="/add-datum", method="post")
					.pure-u-3-4
						input(type="text", data-provide="typeahead", name="category", placeholder="Name/Category", data-source='[#{ categories }]')
					.pure-u-1-4
						input(type="float", name="quantity", placeholder="Quantity")
					input(type="hidden", name="account", value=user._id)
					#submit
						input(type="submit", value="Add Data")
			.main.pure-g-r
				.pure-u-1-3
				.pure-u-1-3.pull-center
					h2.thin You are tracking
				.pure-u-1-3
				for cat in foundCats
					.pure-u-1-5.pull-center
						a(href="/category/#{cat._id}").btn #{cat.name}

			script(src='/javascripts/add-datum.js')
			script(src='/javascripts/index.js')

	if (!user)
		script(src="http://d3js.org/d3.v3.min.js")
		#graph(style="height:200px;")
		- var data = [0], i = 0, dumb = [0];
		- for wd in whenData
			- data.push(wd.value);
			- dumb.push(0);
			- i++;
		- var max_of_array = Math.max.apply(Math, data);
		script
			// create an SVG element inside the #graph div that fills 100% of the div
			var graph = d3.select("#graph").append("svg:svg").attr("width", "100%").attr("height", "100%");

			// create a simple data array that we'll plot with a line (this array represents only the Y values, X will just be the index location)
			var data = [#{data}], dumb = [#{dumb}];
			console.log('max = '+#{max_of_array})

			// X scale will fit values from 0-10 within pixels 0-100
			var x = d3.scale.linear().domain([0, 10]).range([0, 500]);
			// Y scale will fit values from 0-10 within pixels 0-100
			var y = d3.scale.linear().domain([(#{max_of_array}+1), 0]).range([0, 150]);

			// create a line object that represents the SVN line we're creating
			var line = d3.svg.area()
				// assign the X function to plot our line as we wish
				.x(function(d,i) {
					// verbose logging to show what's actually being done
					// console.log('Plotting X value for data point: ' + d + ' using index: ' + i + ' to be at: ' + x(i) + ' using our xScale.');
					// return the X coordinate where we want to plot this datapoint
					return x(i);
				})
				.y1(function(d) {
					// verbose logging to show what's actually being done
					// console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
					// return the Y coordinate where we want to plot this datapoint
					return y(d);
				}).y0(150).interpolate("monotone")

				// display the line by appending an svg:path element with the data line we created above
				graph.append("svg:path")
					.attr("id", "myPath")
					.attr("stroke", "#c3cbf0")
					.attr("stroke-width", 1)
					.attr("fill", "#c3cbf0")
					.attr("d", line(dumb))
					.attr("id", "myPath")
					//.on("mousemove", mMove)
					.transition().duration(1000).attr("d", line(data)).ease('bounce');

				function mMove(){
					var m = d3.svg.mouse(this);
					d3.select("#myPath").select("title").text(m);
				};

